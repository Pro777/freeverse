---
import BaseLayout from "../layouts/BaseLayout.astro";
import { loadFeaturedPoem, loadFirstStanza } from "../lib/poems";

const base = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL
  : `${import.meta.env.BASE_URL}/`;

const featured = await loadFeaturedPoem();
const featuredStanza = featured ? await loadFirstStanza(featured) : undefined;
---

<BaseLayout
  title="Freeverse"
  description="Public-domain poetry â€” a clean reader with shareable line links."
  currentPath="/"
>
  <section class="hero">
    <h1>Freeverse</h1>
    <p class="lede">Public-domain poetry. A clean reader. Shareable line links.</p>
  </section>

  <section class="grid">
    <div class="card card-link">
      <div class="kicker">
        <h2>Featured</h2>
        <span class="pill">A small daily delight</span>
      </div>

      {featured ? (
        <>
          <a
            class="card-overlay"
            href={`${base}poem/${featured.id}/`}
            aria-label={`Read featured poem: ${featured.title} by ${featured.author}`}
          ></a>
          <p style="margin: 0.1rem 0 0.1rem;"><strong>{featured.title}</strong></p>
          <p class="muted" style="margin: 0 0 0.6rem;">{featured.author}</p>
          {featuredStanza ? (
            <pre class="poem-preview">{featuredStanza}</pre>
          ) : (
            <p class="muted">(Preview unavailable.)</p>
          )}
          <div class="actions">
            <a class="action primary" href={`${base}poem/${featured.id}/`}>Read poem</a>
            <a class="action" href={`${base}browse/`}>Explore poems</a>
          </div>
        </>
      ) : (
        <p class="muted">(No featured poem set.)</p>
      )}
    </div>

    <div class="card">
      <div class="kicker">
        <h2>Explore poems</h2>
        <span class="pill">By author, title (more soon)</span>
      </div>
      <p class="muted">
        Browse the collection by author and title. (More filters and favorites soon.)
      </p>
      <div class="actions">
        <a class="action primary" href={`${base}browse/`}>Explore poems</a>
        <a class="action" href="https://github.com/Pro777/freeverse">Project repo</a>
      </div>
    </div>
  </section>
</BaseLayout>
