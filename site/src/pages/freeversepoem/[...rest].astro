---
import { loadPoemMetas } from "../../lib/poems";

// Legacy/broken URL redirect.
// Some internal links previously concatenated BASE_URL without a trailing slash,
// producing /freeversepoem/<...>/ instead of /freeverse/poem/<...>/ on GitHub Pages.

export async function getStaticPaths() {
  const poems = await loadPoemMetas();
  return poems.map((p) => ({ params: { rest: p.id } }));
}

const base = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL
  : `${import.meta.env.BASE_URL}/`;

const { rest } = Astro.params;
const to = `${base}poem/${rest ?? ""}/`;
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="refresh" content={`0;url=${to}`} />
    <link rel="canonical" href={to} />
    <title>Redirecting…</title>
  </head>
  <body>
    <p>Redirecting to <a href={to}>{to}</a>…</p>
    <script is:inline>{`location.replace(${JSON.stringify(to)});`}</script>
  </body>
</html>
